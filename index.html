<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>CodeX AI Assistant</title>
  <link href="https://cdn.jsdelivr.net/npm/remixicon@3.5.0/fonts/remixicon.css" rel="stylesheet" />
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; }
    :root { --primary-bg: #0c0c0c; --secondary-bg: #1a1a1a; --accent-color: #9b59b6; --text-primary: #ffffff; --text-secondary: #dcdcdc; --border-color: #292929; --glow-color: rgba(155, 89, 182, 0.3); --message-hover: #2b2b2b; }
    body { background: var(--primary-bg); color: var(--text-primary); height: 100vh; overflow: hidden; }
    .app { height: 100vh; display: flex; flex-direction: column; }
    .chat-header { height: 56px; padding: 0 24px; display: flex; align-items: center; border-bottom: 1px solid var(--border-color); background: var(--secondary-bg); }
    .header-title { display: flex; align-items: center; gap: 12px; font-size: 18px; font-weight: 600; }
    .logo-container { display: flex; align-items: center; gap: 12px; }
    .logo-icon { width: 32px; height: 32px; }
    .logo-text { font-weight: 700; color: var(--accent-color); }
    .chat-messages { flex: 1; padding: 24px 16px; overflow-y: auto; display: flex; flex-direction: column; gap: 24px; }
    .message { display: flex; gap: 16px; padding: 4px 16px; }
    .message-avatar { width: 32px; height: 32px; border-radius: 50%; margin-top: 4px; }
    .message-content { flex: 1; }
    .message-header { display: flex; align-items: baseline; gap: 12px; margin-bottom: 8px; }
    .message-author { font-weight: 600; color: var(--accent-color); }
    .message-time { color: var(--text-secondary); font-size: 12px; }
    .message-text { color: var(--text-primary); line-height: 1.6; font-size: 15px; }
    .chat-input { padding: 16px 24px 24px; display: flex; gap: 12px; background: var(--primary-bg); border-top: 1px solid var(--border-color); }
    .chat-input textarea { flex: 1; padding: 14px 16px; background: var(--secondary-bg); border: 1px solid var(--border-color); border-radius: 8px; color: var(--text-primary); outline: none; resize: none; font-size: 15px; min-height: 56px; }
    .upload-button { background: var(--accent-color); border: none; border-radius: 8px; color: var(--text-primary); width: 56px; height: 56px; display: flex; align-items: center; justify-content: center; cursor: pointer; }
    .upload-button:disabled { background: #5d3c6a; opacity: 0.7; }
    .upload-button i { font-size: 20px; }
    .loading-indicator { display: inline-block; width: 20px; height: 20px; border: 2px solid rgba(255, 255, 255, 0.3); border-radius: 50%; border-top-color: var(--text-primary); animation: spin 0.8s linear infinite; }
    @keyframes spin { to { transform: rotate(360deg); } }
    .message.ai-message { background: var(--secondary-bg); border-radius: 8px; padding: 16px; border-left: 3px solid var(--accent-color); }
  </style>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>
<body>
  <div id="root"></div>

  <!-- ChatHeader Component -->
  <script type="text/babel">
    const { useState } = React;
    function ChatHeader() {
      return (
        <div className="chat-header">
          <div className="header-title">
            <div className="logo-container">
              <svg className="logo-icon" viewBox="0 0 64 64" width="48" height="48" xmlns="http://www.w3.org/2000/svg">
                <circle cx="32" cy="32" r="28" fill="#9b59b6" />
                <text x="32" y="42" fontSize="28" textAnchor="middle" fill="#ffffff" fontFamily="Arial" fontWeight="bold">CX</text>
              </svg>
              <div className="logo-text">CodeX</div>
            </div>
            <span style={{ marginLeft: "8px" }}>AI Assistant</span>
          </div>
        </div>
      );
    }
  </script>

  <!-- Message Component -->
  <script type="text/babel">
    function Message({ message }) {
      return (
        <div className={`message ${message.isAi ? "ai-message" : ""}`}>
          <img
            className="message-avatar"
            src={message.isAi ? "data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAzMiAzMiI+PHBhdGggZD0iTTI2IDRINmEyIDIgMCAwMD0yIDJ2MjBhMiAyIDAgMDAyIDJoMjBhMiAyIDAgMDAyLTJWNmEyIDIgMCAwMC0yLTJ6TTEyIDIybC00LTQgNC00IDEuNSAxLjVMMTEgMTZsMi41IDIuNUwxMiAyMnptOCAwbC0xLjUtMS41TDIxIDE4bC0yLjUtMi41TDIwIDE0bDQgNC00IDR6bS03LjUtMTJoNWwtNSAxMGgtNWw1LTEweiIgZmlsbD0iIzAwYjBmZiIgLz48L3N2Zz4=" : "https://via.placeholder.com/32"}
            alt={message.isAi ? "CodeX" : "User"}
          />
          <div className="message-content">
            <div className="message-header">
              <span className="message-author">{message.isAi ? "CodeX" : "User"}</span>
              <span className="message-time">{new Date(message.created_at).toLocaleTimeString()}</span>
            </div>
            <div className="message-text">{message.content}</div>
          </div>
        </div>
      );
    }
  </script>

  <!-- ChatInput Component -->
  <script type="text/babel">
    function ChatInput({ newMessage, onMessageChange, onSubmit, isLoading }) {
      return (
        <form className="chat-input" onSubmit={onSubmit}>
          <textarea
            placeholder="Ask CodeX anything about coding..."
            value={newMessage}
            onChange={(e) => onMessageChange(e.target.value)}
          ></textarea>
          <button type="submit" className="upload-button" disabled={isLoading}>
            {isLoading ? <div className="loading-indicator"></div> : <i className="ri-send-plane-fill"></i>}
          </button>
        </form>
      );
    }
  </script>

  <!-- App Component -->
  <script type="text/babel">
    const { useState, useEffect, useRef } = React;

    function App() {
      const [messages, setMessages] = useState([]);
      const [newMessage, setNewMessage] = useState("");
      const [isLoading, setIsLoading] = useState(false);
      const messagesEndRef = useRef(null);

      useEffect(() => {
        messagesEndRef.current?.scrollIntoView({ behavior: "smooth" });
      }, [messages]);

      const handleSendMessage = async (e) => {
        e.preventDefault();
        const trimmed = newMessage.trim();
        if (!trimmed) return;

        const userMessage = {
          id: Date.now(),
          content: trimmed,
          created_at: new Date().toISOString(),
          isAi: false
        };
        const updatedMessages = [...messages, userMessage];
        setMessages(updatedMessages);
        setNewMessage("");
        setIsLoading(true);

        // Fetch from Vercel serverless endpoint
        try {
          const response = await fetch(`/api/chat?message=${encodeURIComponent(trimmed)}`);
          const data = await response.json();
          const aiMessage = {
            id: Date.now() + 1,
            content: data.content,
            created_at: new Date().toISOString(),
            isAi: true
          };
          setMessages([...updatedMessages, aiMessage]);
        } catch (error) {
          const aiMessage = {
            id: Date.now() + 1,
            content: "Error: Couldnâ€™t connect to the AI service.",
            created_at: new Date().toISOString(),
            isAi: true
          };
          setMessages([...updatedMessages, aiMessage]);
        }
        setIsLoading(false);
      };

      return (
        <div className="app">
          <ChatHeader />
          <div className="chat-messages">
            {messages.map((message) => (
              <Message key={message.id} message={message} />
            ))}
            {isLoading && (
              <div className="message ai-message">
                <div className="loading-indicator"></div>
              </div>
            )}
            <div ref={messagesEndRef} />
          </div>
          <ChatInput
            newMessage={newMessage}
            onMessageChange={setNewMessage}
            onSubmit={handleSendMessage}
            isLoading={isLoading}
          />
        </div>
      );
    }

    ReactDOM.createRoot(document.getElementById("root")).render(<App />);
  </script>
</body>
</html>